<html>
<head>
<title>Xpress-Mosel model</title>
</head>
<body>
<STYLE TYPE="text/css" MEDIA=screen>
<!--
 .FontMosel { white-space: pre; font-family: monospace; font-size: 12px; line-height: 1; font-weight: 400; text-decoration: none; }
-->
</STYLE>
<body>

<font class='FontMosel'><pre>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>
<font color="#22a000">!!</font>
<font color="#22a000">!! Carrier Broker Optimisation: Link Flow Model</font>
<font color="#22a000">!!</font>
<font color="#22a000">!!- The following script implements the LFM defined in Section 6.1</font>
<font color="#22a000">!!  of Mari Holmen's and Sindre Møgster Braaten's masters thesis</font>
<font color="#22a000">!!</font>
<font color="#22a000">!!- Authors: Mari Holmen and Sindre Møgster Braaten</font>
<font color="#22a000">!!</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>

<font color="#4444ff">model</font><font color="#000000"> CarrierBrokerLFM</font>

<font color="#4444ff">options</font><font color="#000000"> explterm</font>
<font color="#4444ff">options</font><font color="#000000"> noimplicit</font>
<font color="#4444ff">uses</font><font color="#000000"> </font><font color="#800080">"mmxprs"</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">"mmsystem"</font><font color="#000000">;</font>

<font color="#4444ff">parameters</font>
<font color="#000000">    </font><font color="#22a000">! Data file to read from</font>
<font color="#000000">    Data </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#800080">'data/s2-mosel-link.txt'</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Minimum proportion of total backup requirement reserved on an arc (aka. beta)</font>
<font color="#000000">    MinBackupProportion </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0.25</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Time limit for runtime,  maximum number of seconds for optimisation</font>
<font color="#000000">    TimeLimit </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">-</font><font color="#ff0000">1</font><font color="#000000">; </font>
<font color="#4444ff">end-parameters</font>

<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Model Parameters:"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Data:"</font><font color="#ff0000">,</font><font color="#000000"> Data</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"MinBackupProportion(beta):"</font><font color="#ff0000">,</font><font color="#000000"> MinBackupProportion</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"TimeLimit:"</font><font color="#ff0000">,</font><font color="#000000"> TimeLimit</font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#4444ff">declarations</font>
<font color="#000000">    timetracker:    </font><font color="#4444ff">real</font><font color="#000000">; </font><font color="#22a000">! used to log timestamps for time consumption output</font>
<font color="#4444ff">end-declarations</font>

<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Building model..."</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">timetracker </font><font color="#ff0000">:=</font><font color="#000000"> timestamp;</font>

<font color="#22a000">!setparam("XPRS_presolve", 0);  ! uncomment to turn of presolve</font>
<font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#000000">TimeLimit</font><font color="#ff0000">></font><font color="#ff0000">0.0</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">    </font><font color="#4444ff">setparam</font><font color="#4444ff">(</font><font color="#800080">"XPRS_maxtime"</font><font color="#ff0000">,</font><font color="#000000"> TimeLimit</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-if</font>

<font color="#4444ff">setparam</font><font color="#4444ff">(</font><font color="#800080">"XPRS_verbose"</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#4444ff">true</font><font color="#4444ff">)</font><font color="#000000">; </font><font color="#22a000">! Turn on message printing</font>
<font color="#4444ff">setparam</font><font color="#4444ff">(</font><font color="#800080">"XPRS_MIPLOG"</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#ff0000">2</font><font color="#4444ff">)</font><font color="#000000">; </font><font color="#22a000">! 2: print information for each solution found </font>
<font color="#000000">                            </font><font color="#22a000">!(ALT: 0: no log, 1: summary in end, 3: log each node, -N: log every Nth node)</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!</font>
<font color="#22a000">! SETS</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!</font>

<font color="#4444ff">declarations</font>
<font color="#22a000">! Set sizes</font>
<font color="#000000">    n_Customers:            </font><font color="#4444ff">integer</font><font color="#000000">; </font><font color="#22a000">! number of customers</font>
<font color="#000000">    n_Services:             </font><font color="#4444ff">integer</font><font color="#000000">; </font><font color="#22a000">! number of services</font>
<font color="#000000">    n_Providers:            </font><font color="#4444ff">integer</font><font color="#000000">; </font><font color="#22a000">! number of providers</font>
<font color="#000000">    n_Nodes:                </font><font color="#4444ff">integer</font><font color="#000000">; </font><font color="#22a000">! number of nodes in total</font>

<font color="#22a000">! Sets  </font>
<font color="#000000">    Customers:              </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">; </font>
<font color="#000000">    Providers:              </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Used as shorthand for 'cc in Customers, ss in S_ServicesForCustomer(cc)' when cc is not needed </font>
<font color="#000000">    Services:               </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Set of nodes in the network. </font>
<font color="#000000">    </font><font color="#22a000">! - First we have the customer nodes, then the internal nodes, the the provider nodes.</font>
<font color="#000000">    Nodes:                  </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">; </font>
<font color="#000000">    </font><font color="#22a000">! Set of internal nodes in the network + all customer nodes </font>
<font color="#000000">    </font><font color="#22a000">! - usage for internal nodes for each customer cc: 'nn in I_Nodes | nn<>cc'</font>
<font color="#000000">    I_Nodes:                </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">;</font>
<font color="#4444ff">end-declarations</font>

<font color="#4444ff">initializations from</font><font color="#000000"> Data</font>
<font color="#000000">    n_Customers;</font>
<font color="#000000">    n_Services;</font>
<font color="#000000">    n_Providers;</font>
<font color="#000000">    n_Nodes;</font>
<font color="#4444ff">end-initializations</font>

<font color="#000000">Customers</font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#ff0000">1.</font><font color="#ff0000">.</font><font color="#000000">n_Customers;</font>
<font color="#000000">Services</font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#ff0000">1.</font><font color="#ff0000">.</font><font color="#000000">n_Services;  </font>
<font color="#000000">Providers</font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#ff0000">1.</font><font color="#ff0000">.</font><font color="#000000">n_Providers;</font>
<font color="#000000">Nodes</font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#ff0000">1.</font><font color="#ff0000">.</font><font color="#000000">n_Nodes;</font>
<font color="#000000">I_Nodes</font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#ff0000">1.</font><font color="#ff0000">.</font><font color="#4444ff">(</font><font color="#000000">n_Nodes</font><font color="#ff0000">-</font><font color="#000000">n_Providers</font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#4444ff">finalize</font><font color="#4444ff">(</font><font color="#000000">Customers</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">finalize</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">finalize</font><font color="#4444ff">(</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">finalize</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">finalize</font><font color="#4444ff">(</font><font color="#000000">I_Nodes</font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#22a000">! INDEXED SETS</font>

<font color="#4444ff">declarations</font>
<font color="#000000">    </font><font color="#22a000">! set of services of for each customer cc</font>
<font color="#000000">    S_ServicesForCustomer:      </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">;</font>
<font color="#4444ff">end-declarations</font>

<font color="#4444ff">initialisations from</font><font color="#000000"> Data</font>
<font color="#000000">    S_ServicesForCustomer;</font>
<font color="#4444ff">end-initialisations</font>

<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!</font>
<font color="#22a000">! PARAMETERS</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!</font>

<font color="#4444ff">declarations</font>
<font color="#22a000">! Parameters</font>
<font color="#000000">    </font><font color="#22a000">! Price per used capacity between nodes</font>
<font color="#000000">    K_CapPrice:                 </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! R_Revenue from serving each customer</font>
<font color="#000000">    R_Revenue:                  </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Customers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Price of placing a service at a provider</font>
<font color="#000000">    H_PlacePrice:               </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Latency requirement for each service from customer to provider</font>
<font color="#000000">    G_LatencyReq:               </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Bandwidth requirement for each service from customer to provider</font>
<font color="#000000">    B_BandwidthReqUp:               </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Bandwidth requirement for each service from provider to customer</font>
<font color="#000000">    B_BandwidthReqDown:         </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Minimum avarage availability for each service</font>
<font color="#000000">    Y_AvailabilityReq:          </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">; </font>
<font color="#000000">    </font><font color="#22a000">! Lateny between each pair of nodes</font>
<font color="#000000">    T_LinkLatency:              </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Bandwidth capacity between each pair of nodes</font>
<font color="#000000">    F_BandwidthCap:             </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Expected availability for each owned link between each pair of nodes</font>
<font color="#000000">    D_AvailabilityExp:          </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">real</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! Node for each provider</font>
<font color="#000000">    E_ProviderNode:             </font><font color="#4444ff">set</font><font color="#000000"> </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">integer</font><font color="#000000">; </font>

<font color="#22a000">! Network data interpretation configuration</font>
<font color="#000000">    Symmetric:              </font><font color="#4444ff">boolean</font><font color="#000000">;</font>

<font color="#4444ff">end-declarations</font>

<font color="#4444ff">initialisations from</font><font color="#000000"> Data               </font>
<font color="#000000">    K_CapPrice;                 </font>
<font color="#000000">    R_Revenue;              </font>
<font color="#000000">    H_PlacePrice;                               </font>
<font color="#000000">    G_LatencyReq;   </font>
<font color="#000000">    B_BandwidthReqUp;</font>
<font color="#000000">    B_BandwidthReqDown;</font>
<font color="#000000">    Y_AvailabilityReq;                      </font>
<font color="#000000">    T_LinkLatency;                      </font>
<font color="#000000">    F_BandwidthCap;                     </font>
<font color="#000000">    D_AvailabilityExp;</font>

<font color="#000000">    Symmetric;</font>
<font color="#4444ff">end-initialisations</font>

<font color="#22a000">! Provider nodes are the n_Providers last nodes in network</font>
<font color="#000000">E_ProviderNode</font><font color="#ff0000">:=</font><font color="#4444ff">(</font><font color="#000000">n_Nodes</font><font color="#ff0000">-</font><font color="#000000">n_Providers</font><font color="#ff0000">+</font><font color="#ff0000">1</font><font color="#4444ff">)</font><font color="#ff0000">..</font><font color="#000000">n_Nodes;</font>
<font color="#4444ff">finalize</font><font color="#4444ff">(</font><font color="#000000">E_ProviderNode</font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#22a000">! If Symmetric is set to true in provided dataset</font>
<font color="#22a000">! - duplicate all arcs in dataset in its opposite direction if opposite not already specified</font>
<font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#000000">Symmetric</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">    </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>

<font color="#000000">        </font><font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#1d8f96">and</font><font color="#000000"> </font><font color="#1d8f96">not</font><font color="#000000"> </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">            </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#ff0000">:=</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">end-if</font>

<font color="#000000">        </font><font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#1d8f96">and</font><font color="#000000"> </font><font color="#1d8f96">not</font><font color="#000000"> </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">            </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#ff0000">:=</font><font color="#000000">T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">end-if</font>

<font color="#000000">        </font><font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#1d8f96">and</font><font color="#000000"> </font><font color="#1d8f96">not</font><font color="#000000"> </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">            </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#ff0000">:=</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">end-if</font>

<font color="#000000">        </font><font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#1d8f96">and</font><font color="#000000"> </font><font color="#1d8f96">not</font><font color="#000000"> </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">            </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">end-if</font>
<font color="#000000">    </font><font color="#4444ff">end-do</font>
<font color="#4444ff">end-if</font>

<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>
<font color="#22a000">! VARIABLES</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>

<font color="#4444ff">declarations</font><font color="#000000">    </font>
<font color="#000000">    </font><font color="#22a000">!Variables</font>
<font color="#000000">    </font><font color="#22a000">! - x: binary, placement of service at provider</font>
<font color="#000000">    x_Placement:        </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000">          </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! - u: binary, use of arc for service for uplink (and oppsite arc for downlink)</font>
<font color="#000000">    u_UsePrimary:       </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">         </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! - y: binary, serving of a customer</font>
<font color="#000000">    y_Serve:            </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Customers</font><font color="#4444ff">)</font><font color="#000000">                    </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! - b : binary, use of arc for service for backup uplink (and opposite arc for downlink)</font>
<font color="#000000">    b_UseBackup:        </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">         </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! - r : binary, is service s needs backup on its path to provider p</font>
<font color="#000000">    r_RequireBackup:    </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">           </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! - l (lambda): continuous, bandwidth reserved for backup on a (owned) link</font>
<font color="#000000">    l_BackupRes:        </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000">                  </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#22a000">! - l: binary, indicates if two services have overlapping primary paths</font>
<font color="#000000">    l_Overlap:          </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">            </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">mpvar</font><font color="#000000">;</font>
<font color="#4444ff">end-declarations</font><font color="#000000">    </font>

<font color="#22a000">! - for all valid combinations of service and provider</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#ff0000">,</font><font color="#000000"> pp </font><font color="#ff0000">in</font><font color="#000000"> Providers | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">H_PlacePrice</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">create</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">is_binary</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">r_RequireBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    r_RequireBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">is_binary</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! - for evary arc in network</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">ii </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> jj </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! - for every service</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers</font><font color="#ff0000">,</font><font color="#000000"> ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#22a000">! - for every arc in network</font>
<font color="#000000">    </font><font color="#22a000">! -- EXCEPT: arcs in to customer node of service, as paths from customer to provider will</font>
<font color="#000000">    </font><font color="#22a000">!            never traverse these links</font>
<font color="#000000">    </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">ii </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> jj </font><font color="#ff0000">in</font><font color="#000000"> Nodes | jj</font><font color="#ff0000"><></font><font color="#000000">cc </font><font color="#1d8f96">and</font><font color="#000000"> </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">        </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">is_binary</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">is_binary</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">end-do</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! - for all customers</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">is_binary</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! - for every distinct pair of two services</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#ff0000">,</font><font color="#000000"> tt </font><font color="#ff0000">in</font><font color="#000000"> Services | ss </font><font color="#ff0000"><</font><font color="#000000"> tt</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">create</font><font color="#4444ff">(</font><font color="#000000">l_Overlap</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">tt</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>
<font color="#22a000">! CONSTRAINTS</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>

<font color="#4444ff">declarations</font>
<font color="#22a000">! Objective function</font>
<font color="#000000">    Total_Profits:                                                              </font><font color="#4444ff">linctr</font><font color="#000000">;</font>

<font color="#22a000">! Constraints</font>
<font color="#000000">    ServeCustomer:              </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">                         </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    ArcCapacity:                </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000">                      </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    PrimaryStartRequirement:    </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">                         </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    BackupStartRequirement:     </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">                         </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    BandwidthFlowPrimary:       </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">I_Nodes</font><font color="#4444ff">)</font><font color="#000000">                 </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    BandwidthFlowBackup:        </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">I_Nodes</font><font color="#4444ff">)</font><font color="#000000">                 </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    PrimaryEndRequirement:      </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">               </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    BackupEndRequirement:       </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">               </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    PrimaryLatencyRequirement:  </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">               </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    BackupLatencyRequirement:   </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">               </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    AllocateBackupPath:         </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Providers</font><font color="#4444ff">)</font><font color="#000000">               </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    AvailabilityRequirement:    </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">                         </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    SumBackupLimit:             </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#4444ff">)</font><font color="#000000">                      </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    SingleBackupLimit:          </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">             </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    LinkDisjoint:               </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">             </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    PrimaryOverlap:             </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">    </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#000000">    BackupOverlap:              </font><font color="#4444ff">dynamic</font><font color="#000000"> </font><font color="#4444ff">array</font><font color="#4444ff">(</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Nodes</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#ff0000">,</font><font color="#000000">Services</font><font color="#4444ff">)</font><font color="#000000">    </font><font color="#4444ff">of</font><font color="#000000"> </font><font color="#4444ff">linctr</font><font color="#000000">;</font>
<font color="#4444ff">end-declarations</font>

<font color="#22a000">! OBJECTIVE FUNCTION</font>
<font color="#22a000">! - total profits from serving customers</font>
<font color="#000000">Total_Profits </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">        </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#22a000">! R_Revenue from serving customer (if served)</font>
<font color="#000000">            R_Revenue</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font><font color="#000000"> </font>
<font color="#000000">            </font><font color="#22a000">! costs associated with customer's required services</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                </font><font color="#22a000">! placement cost</font>
<font color="#000000">                </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                    H_PlacePrice</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#ff0000">+</font><font color="#000000"> </font>
<font color="#000000">                </font><font color="#22a000">! network usage cost</font>
<font color="#000000">                </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                    K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">                    </font><font color="#ff0000">*</font>
<font color="#000000">                    </font><font color="#4444ff">(</font>
<font color="#000000">                        B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">                        </font><font color="#ff0000">+</font>
<font color="#000000">                        B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">                    </font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">-</font>
<font color="#000000">        </font><font color="#22a000">!Backup use cost</font>
<font color="#000000">        </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font>
<font color="#000000">    </font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#22a000">! SERVE CUSTOMER CONSTRAINT</font>
<font color="#22a000">! Customers can only be served if all services for customer is provided</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">        ServeCustomer</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000"> x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">-</font><font color="#000000"> y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">end-do</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! ARC TOTAL CAPACITY CONSTRAINT</font>
<font color="#22a000">! Use of an arc must not exceed its capacity (primary + backup cap)</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes| </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">do</font>
<font color="#000000">    ArcCapacity</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">        </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">+</font>
<font color="#000000">            B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000">           </font>
<font color="#000000">        </font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">+</font>
<font color="#000000">        l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000"><=</font><font color="#000000"> </font>
<font color="#000000">        F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">    </font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! CUSTOMER NODE ROUTING START CONSTRAINTS:</font>
<font color="#22a000">! primary / backup must select arc from customer node if chosen</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers</font><font color="#ff0000">,</font><font color="#000000"> ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    PrimaryStartRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | mm</font><font color="#ff0000"><></font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">)</font>
<font color="#000000">             </font><font color="#ff0000">-</font><font color="#000000"> y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#000000">  </font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;   </font>
<font color="#000000">    BackupStartRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | mm</font><font color="#ff0000"><></font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#000000"> b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000"> r_RequireBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">=</font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! ROUTING FLOW CONSTRAINTS</font>
<font color="#22a000">! - routing in to a node for a service must be equal to the routing out </font>
<font color="#22a000">!   (unless a it is a provider node or the service's customer node)</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers</font><font color="#ff0000">,</font><font color="#000000"> ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000"> nn </font><font color="#ff0000">in</font><font color="#000000"> I_Nodes | nn</font><font color="#ff0000"><></font><font color="#000000">cc </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    BandwidthFlowPrimary</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font><font color="#000000"> </font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#000000">    BandwidthFlowBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! PLACEMENT SIDE ROUTING END CONSTRAINTS</font>
<font color="#22a000">! primary / backup must select arc in to placement node if chosen, or act as transit node</font>
<font color="#22a000">! if not selected / not able to be selected</font>
<font color="#22a000">! and primary and backup routing must end at same provider</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#ff0000">,</font><font color="#000000"> pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    PrimaryEndRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes | nn</font><font color="#ff0000"><></font><font color="#000000">E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000"> E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font><font color="#000000"> </font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | mm</font><font color="#ff0000"><></font><font color="#000000">E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#000000">    BackupEndRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes | nn</font><font color="#ff0000"><></font><font color="#000000">E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000"> E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | mm</font><font color="#ff0000"><></font><font color="#000000">E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">E_ProviderNode</font><font color="#4444ff">(</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            r_RequireBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font>
<font color="#000000">    </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#000000">    </font>
<font color="#000000">    </font><font color="#4444ff">if</font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">H_PlacePrice</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">        </font><font color="#22a000">! can only have backup paths to same provider as primary</font>
<font color="#000000">        AllocateBackupPath</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">:=</font><font color="#000000"> r_RequireBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">-</font><font color="#000000"> x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000"><=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">end-if</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! LATENCY REQUIREMENT CONSTRAINTS</font>
<font color="#22a000">! - user -> placement: for each service, latency for any used path must meet latency requirements</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#ff0000">,</font><font color="#000000"> pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    PrimaryLatencyRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">+</font><font color="#000000"> u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000"><=</font><font color="#000000"> G_LatencyReq</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    </font>
<font color="#000000">    BackupLatencyRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                T_LinkLatency</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">(</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">+</font><font color="#000000"> b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000"><=</font><font color="#000000"> G_LatencyReq</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! AVAILABILITY CONSTRAINTS</font>
<font color="#22a000">! Primary path must have sufficient availability or a link disjoint backup path must be provided</font>
<font color="#22a000">! - linearised by using logarithms</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font><font color="#000000">  </font>
<font color="#000000">    AvailabilityRequirement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">        </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000"> nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">ln</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">*</font><font color="#000000"> u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">+</font>
<font color="#000000">        </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font><font color="#000000"> r_RequireBackup</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">>=</font><font color="#000000"> </font>
<font color="#000000">        </font><font color="#4444ff">ln</font><font color="#4444ff">(</font><font color="#000000">Y_AvailabilityReq</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! SUM BACKUP REQUIREMENT</font>
<font color="#22a000">! must reserve a certain proportion of the sum of backup requirements on an arc</font>
<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    SumBackupLimit</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">        MinBackupProportion</font><font color="#ff0000">*</font>
<font color="#000000">        </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">+</font>
<font color="#000000">            B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">-</font><font color="#000000"> </font>
<font color="#000000">        l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000"><=</font><font color="#000000"> </font><font color="#ff0000">0</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ii </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> jj </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> ss </font><font color="#ff0000">in</font><font color="#000000"> Services </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#22a000">! MAXIMUM BACKUP CONTRAINT</font>
<font color="#000000">    </font><font color="#22a000">! Must reserve backup capacity at least as high as the maximal single backup requirement</font>
<font color="#000000">    SingleBackupLimit</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">        B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">*</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000">  </font><font color="#22a000">! 1 if ii,jj is used in way UP</font>
<font color="#000000">        </font><font color="#ff0000">+</font>
<font color="#000000">        B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#ff0000">*</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000">  </font><font color="#22a000">! 1 if ii,jj is used in way DOWN</font>
<font color="#000000">        </font><font color="#ff0000">-</font>
<font color="#000000">        l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#4444ff">)</font><font color="#000000"> </font>
<font color="#000000">        </font><font color="#ff0000"><=</font><font color="#000000"> </font><font color="#ff0000">0</font>
<font color="#000000">    </font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    </font>
<font color="#000000">    </font><font color="#22a000">! LINK DISJOINT CONSTRAINTS</font>
<font color="#000000">    </font><font color="#22a000">! The primary and backup path (if given) for a service must be link disjoint</font>
<font color="#000000">    LinkDisjoint</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">:=</font><font color="#000000"> b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">+</font><font color="#000000"> u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000"><=</font><font color="#ff0000">1</font><font color="#000000">;</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">! SERVICE PATH OVERLAP CONSTRAINTS</font>
<font color="#22a000">! To services have overlapping main paths if for any arc both paths are represented</font>
<font color="#22a000">! for every service combination</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#ff0000">,</font><font color="#000000"> tt </font><font color="#ff0000">in</font><font color="#000000"> Services | ss </font><font color="#ff0000"><</font><font color="#000000"> tt</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#22a000">! for every LINK ( (i,j) in A | i < j) </font>
<font color="#000000">    </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">ii </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> jj </font><font color="#ff0000">in</font><font color="#000000"> Nodes | ii </font><font color="#ff0000"><</font><font color="#000000"> jj </font><font color="#1d8f96">and</font><font color="#000000"> </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">                                        </font>
<font color="#000000">        </font><font color="#22a000">! PRIMARY PATH OVERLAP CONSTRAINTS</font>
<font color="#000000">        </font><font color="#22a000">! Two services have overlapping primary paths if for any LINK both services</font>
<font color="#000000">        </font><font color="#22a000">! has selected one of the link's two arcs</font>
<font color="#000000">        PrimaryOverlap</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000"> jj</font><font color="#ff0000">,</font><font color="#000000"> ss</font><font color="#ff0000">,</font><font color="#000000"> tt</font><font color="#4444ff">)</font><font color="#ff0000">:=</font><font color="#000000"> </font>
<font color="#000000">            u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">+</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#22a000">! 1 if ss uses link</font>
<font color="#000000">            </font><font color="#ff0000">+</font>
<font color="#000000">            u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">tt</font><font color="#4444ff">)</font><font color="#ff0000">+</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">tt</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#22a000">! 1 if tt uses link</font>
<font color="#000000">            </font><font color="#ff0000">-</font>
<font color="#000000">            l_Overlap</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000"> tt</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000"><=</font><font color="#000000"> </font><font color="#ff0000">1</font><font color="#000000">;</font>
<font color="#000000">            </font>
<font color="#000000">        </font><font color="#22a000">! BACKUP PATH OVERLAP CONSTRAINT</font>
<font color="#000000">        </font><font color="#22a000">! backup paths may not overlap at any LINK if their primary paths overlap anywhere</font>
<font color="#000000">        BackupOverlap</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000"> jj</font><font color="#ff0000">,</font><font color="#000000"> ss</font><font color="#ff0000">,</font><font color="#000000">tt</font><font color="#4444ff">)</font><font color="#ff0000">:=</font><font color="#000000"> </font>
<font color="#000000">            b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">+</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#22a000">! 1 if ss uses link</font>
<font color="#000000">            </font><font color="#ff0000">+</font>
<font color="#000000">            b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">tt</font><font color="#4444ff">)</font><font color="#ff0000">+</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">ii</font><font color="#ff0000">,</font><font color="#000000">jj</font><font color="#ff0000">,</font><font color="#000000">tt</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#22a000">! 1 if tt uses link</font>
<font color="#000000">            </font><font color="#ff0000">+</font>
<font color="#000000">            l_Overlap</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000"> tt</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000"><=</font><font color="#000000"> </font><font color="#ff0000">2</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">end-do</font>
<font color="#4444ff">end-do</font>

<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Model building completed in "</font><font color="#ff0000">,</font><font color="#000000"> timestamp </font><font color="#ff0000">-</font><font color="#000000"> timetracker</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">" seconds"</font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Solving model..."</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">timetracker </font><font color="#ff0000">:=</font><font color="#000000"> timestamp;</font>
<font color="#1d8f96">maximize</font><font color="#4444ff">(</font><font color="#1d8f96">XPRS_PRI</font><font color="#ff0000">,</font><font color="#000000"> Total_Profits</font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#1d8f96">getprobstat</font><font color="#ff0000">=</font><font color="#1d8f96">XPRS_OPT</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">    </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Model solved in "</font><font color="#ff0000">,</font><font color="#000000"> timestamp </font><font color="#ff0000">-</font><font color="#000000"> timetracker</font><font color="#ff0000">,</font><font color="#800080">" seconds"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">else</font>
<font color="#000000">    </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"Model was not solved after "</font><font color="#ff0000">,</font><font color="#000000"> timestamp </font><font color="#ff0000">-</font><font color="#000000"> timetracker</font><font color="#ff0000">,</font><font color="#800080">" seconds"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">end-if</font>

<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>
<font color="#22a000">!</font>
<font color="#22a000">!   Solution output:</font>
<font color="#22a000">! - this following part contains logic for outputting the solution as human</font>
<font color="#22a000">!   readable text and is not part of the model itself.</font>
<font color="#22a000">!</font>
<font color="#22a000">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</font>

<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"\nTotal Profits: "</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#4444ff">getobjval</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"\nBackup Costs: "</font><font color="#ff0000">,</font>
<font color="#000000">    </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#22a000">! for all customers being served</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">cc </font><font color="#ff0000">in</font><font color="#000000"> Customers | </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">></font><font color="#000000"> </font><font color="#ff0000">0.1</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#22a000">! output customer information and generated profits (excluding backup costs)</font>
<font color="#000000">    </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"\n\nCustomer "</font><font color="#ff0000">,</font><font color="#000000"> cc</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">" (node "</font><font color="#ff0000">,</font><font color="#000000">cc</font><font color="#ff0000">,</font><font color="#800080">") is being served\n - R_Revenue: "</font><font color="#ff0000">,</font>
<font color="#000000">        R_Revenue</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#800080">"\n - profits: "</font><font color="#ff0000">,</font><font color="#4444ff">(</font>
<font color="#000000">            R_Revenue</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">y_Serve</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000">-</font><font color="#000000"> </font>
<font color="#000000">            </font><font color="#22a000">! costs associated with customer's required services</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">(</font>
<font color="#000000">                    </font><font color="#22a000">! placement cost</font>
<font color="#000000">                    </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">pp </font><font color="#ff0000">in</font><font color="#000000"> Providers</font><font color="#4444ff">)</font>
<font color="#000000">                        H_PlacePrice</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                    </font><font color="#ff0000">+</font><font color="#000000"> </font>
<font color="#000000">                    </font><font color="#22a000">! network usage cost</font>
<font color="#000000">                    </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                            K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">                            </font><font color="#ff0000">*</font><font color="#4444ff">(</font>
<font color="#000000">                                </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                                </font><font color="#ff0000">+</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                            </font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000">;</font>

<font color="#000000">    </font><font color="#22a000">! for all services of the served customer</font>
<font color="#000000">    </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> S_ServicesForCustomer</font><font color="#4444ff">(</font><font color="#000000">cc</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">        </font><font color="#22a000">! for the provider selected for the service (x only > 0.1 for one)</font>
<font color="#000000">        </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">pp </font><font color="#ff0000">in</font><font color="#000000"> Providers | </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">></font><font color="#000000"> </font><font color="#ff0000">0.1</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">            </font><font color="#22a000">! output information about service and placement</font>
<font color="#000000">            </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font>
<font color="#000000">                </font><font color="#800080">"\n - Service "</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#800080">":\n  - Costs: "</font><font color="#ff0000">,</font>
<font color="#000000">                </font><font color="#4444ff">(</font><font color="#000000">   </font><font color="#22a000">! Calculate costs for this specific service</font>
<font color="#000000">                    H_PlacePrice</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">x_Placement</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                    </font><font color="#ff0000">+</font><font color="#000000"> </font>
<font color="#000000">                    </font><font color="#4444ff">sum</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                        K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">                        </font><font color="#ff0000">*</font><font color="#4444ff">(</font>
<font color="#000000">                            </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">                            </font><font color="#ff0000">+</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">                        </font><font color="#4444ff">)</font>
<font color="#000000">                    </font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font><font color="#ff0000">,</font>
<font color="#000000">                </font><font color="#800080">"\n  - placement: provider #"</font><font color="#ff0000">,</font><font color="#000000"> pp</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">" (node "</font><font color="#ff0000">,</font><font color="#4444ff">(</font><font color="#000000">n_Nodes</font><font color="#ff0000">-</font><font color="#000000">n_Providers</font><font color="#ff0000">+</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">,</font>
<font color="#000000">                </font><font color="#800080">") - Cost: "</font><font color="#ff0000">,</font><font color="#000000">H_PlacePrice</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#ff0000">,</font><font color="#000000">pp</font><font color="#4444ff">)</font><font color="#ff0000">,</font>
<font color="#000000">                </font><font color="#800080">"    -Availability without backup: "</font><font color="#ff0000">,</font><font color="#000000"> </font>
<font color="#000000">                </font><font color="#4444ff">exp</font><font color="#4444ff">(</font>
<font color="#000000">                    </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000"> nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                        </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">ln</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                    </font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font><font color="#ff0000">,</font>
<font color="#000000">                </font><font color="#800080">"    -Availability requirement: "</font><font color="#ff0000">,</font><font color="#000000"> Y_AvailabilityReq</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font><font color="#000000">; </font>
<font color="#000000">        </font><font color="#4444ff">end-do</font>

<font color="#000000">        </font><font color="#22a000">! output primary path network routing information for service</font>
<font color="#000000">        </font><font color="#22a000">! - up-link</font>
<font color="#000000">        </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"   - ARCS:\n      - primary usage up:"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">            </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">></font><font color="#000000"> </font><font color="#ff0000">0.1</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">                </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"        - ("</font><font color="#ff0000">,</font><font color="#000000"> nn</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">","</font><font color="#ff0000">,</font><font color="#000000"> mm</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">") : "</font><font color="#ff0000">,</font>
<font color="#000000">                        B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000"> </font>
<font color="#000000">                        </font><font color="#800080">"    ("</font><font color="#ff0000">,</font>
<font color="#000000">                        K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#800080">")"</font><font color="#000000"> </font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            </font><font color="#4444ff">end-if</font>
<font color="#000000">        </font><font color="#4444ff">end-do</font>
<font color="#000000">        </font><font color="#22a000">! - down-link</font>
<font color="#000000">        </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"      - primary usage down:"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">        </font><font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">            </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">></font><font color="#000000"> </font><font color="#ff0000">0.1</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">                </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"        - ("</font><font color="#ff0000">,</font><font color="#000000"> mm</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">","</font><font color="#ff0000">,</font><font color="#000000"> nn</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#800080">") : "</font><font color="#ff0000">,</font>
<font color="#000000">                        B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#000000"> </font>
<font color="#000000">                        </font><font color="#800080">"    ("</font><font color="#ff0000">,</font>
<font color="#000000">                        K_CapPrice</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#000000">B_BandwidthReqDown</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">,</font><font color="#800080">")"</font><font color="#000000"> </font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            </font><font color="#4444ff">end-if</font>
<font color="#000000">        </font><font color="#4444ff">end-do</font>
<font color="#000000">        </font>
<font color="#000000">        </font><font color="#22a000">! if this service requires a backup path (given its primary path routing)</font>
<font color="#000000">        </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000"> nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">(</font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">ln</font><font color="#4444ff">(</font><font color="#000000">D_AvailabilityExp</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#ff0000"><</font><font color="#000000"> </font><font color="#4444ff">ln</font><font color="#4444ff">(</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">Y_AvailabilityReq</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">            </font><font color="#22a000">! output backup path network routing information</font>
<font color="#000000">            </font><font color="#22a000">! - up-link</font>
<font color="#000000">            </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"      - backup usage up:"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            </font><font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">                </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">=</font><font color="#ff0000">1</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">                    </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"        - ("</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#800080">","</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#800080">"): "</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">                </font><font color="#4444ff">end-if</font>
<font color="#000000">            </font><font color="#4444ff">end-do</font>
<font color="#000000">            </font><font color="#22a000">! - down-link</font>
<font color="#000000">            </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"      - backup usage down:"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">            </font><font color="#4444ff">forall</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">                </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">b_UseBackup</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#ff0000">=</font><font color="#ff0000">1</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">                    </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"        - ("</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#800080">","</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#800080">"): "</font><font color="#ff0000">,</font><font color="#000000"> </font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">l_BackupRes</font><font color="#4444ff">(</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">                </font><font color="#4444ff">end-if</font>
<font color="#000000">            </font><font color="#4444ff">end-do</font>
<font color="#000000">        </font><font color="#4444ff">end-if</font>
<font color="#000000">    </font><font color="#4444ff">end-do</font>
<font color="#4444ff">end-do</font>

<font color="#22a000">!! Output information about total bandwidth usage on arcs</font>
<font color="#22a000">! arcs with high bandwidth usage</font>
<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"\n\nArcs with high utilisation of capacity (>=90%):"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000"> B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">>=</font><font color="#000000"> F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#ff0000">0.9</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">        </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#800080">" - ("</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#800080">","</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#800080">") "</font><font color="#ff0000">,</font>
<font color="#000000">            </font><font color="#4444ff">(</font><font color="#000000"> </font>
<font color="#000000">                </font><font color="#ff0000">100</font><font color="#ff0000">*</font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">(</font>
<font color="#000000">                    B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">/</font><font color="#000000"> F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font><font color="#ff0000">,</font>
<font color="#000000">            </font><font color="#800080">" %"</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">end-if</font>
<font color="#4444ff">end-do</font>
<font color="#22a000">! arcs with medium bandwidth usage</font>
<font color="#4444ff">writeln</font><font color="#4444ff">(</font><font color="#800080">"\n\nArcs with medium utilisation of capacity (< 10%, < 90%):"</font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#4444ff">forall</font><font color="#4444ff">(</font><font color="#000000">nn </font><font color="#ff0000">in</font><font color="#000000"> Nodes</font><font color="#ff0000">,</font><font color="#000000"> mm </font><font color="#ff0000">in</font><font color="#000000"> Nodes | </font><font color="#4444ff">exists</font><font color="#4444ff">(</font><font color="#000000">F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">do</font>
<font color="#000000">    </font><font color="#4444ff">if</font><font color="#000000"> </font><font color="#4444ff">(</font><font color="#4444ff">(</font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000">B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">></font><font color="#000000"> F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#ff0000">0.1</font><font color="#000000"> </font><font color="#1d8f96">and</font>
<font color="#000000">        </font><font color="#4444ff">(</font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#000000">B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000"><</font><font color="#000000"> F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#ff0000">0.9</font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#4444ff">then</font>
<font color="#000000">        </font><font color="#4444ff">writeln</font><font color="#4444ff">(</font>
<font color="#000000">            </font><font color="#800080">" - ("</font><font color="#ff0000">,</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#800080">","</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#800080">") "</font><font color="#ff0000">,</font><font color="#000000"> </font>
<font color="#000000">            </font><font color="#4444ff">(</font>
<font color="#000000">                </font><font color="#ff0000">100</font><font color="#ff0000">*</font><font color="#4444ff">sum</font><font color="#4444ff">(</font><font color="#000000">ss </font><font color="#ff0000">in</font><font color="#000000"> Services</font><font color="#4444ff">)</font><font color="#4444ff">(</font>
<font color="#000000">                    B_BandwidthReqUp</font><font color="#4444ff">(</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#ff0000">*</font><font color="#4444ff">getsol</font><font color="#4444ff">(</font><font color="#000000">u_UsePrimary</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#ff0000">,</font><font color="#000000">ss</font><font color="#4444ff">)</font><font color="#4444ff">)</font>
<font color="#000000">                </font><font color="#4444ff">)</font><font color="#000000"> </font><font color="#ff0000">/</font><font color="#000000"> F_BandwidthCap</font><font color="#4444ff">(</font><font color="#000000">nn</font><font color="#ff0000">,</font><font color="#000000">mm</font><font color="#4444ff">)</font>
<font color="#000000">            </font><font color="#4444ff">)</font><font color="#ff0000">,</font>
<font color="#000000">            </font><font color="#800080">" %"</font>
<font color="#000000">        </font><font color="#4444ff">)</font><font color="#000000">;</font>
<font color="#000000">    </font><font color="#4444ff">end-if</font>
<font color="#4444ff">end-do</font>

<font color="#4444ff">end-model</font>
</pre></font></body></html>